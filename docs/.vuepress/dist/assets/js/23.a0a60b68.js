(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{400:function(t,s,a){"use strict";a.r(s);var e=a(46),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"单机部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单机部署"}},[t._v("#")]),t._v(" 单机部署")]),t._v(" "),a("p",[t._v("操作系统：CentOS Linux release 7.7.1908 （阿里云） （单机部署）（无证书）")]),t._v(" "),a("h3",{attrs:{id:"下载-etcd-二进制文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载-etcd-二进制文件"}},[t._v("#")]),t._v(" 下载 etcd 二进制文件")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/coreos/etcd/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("release"),a("OutboundLink")],1),t._v(" 查找自己需要的版本。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改你需要的版本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ETCD_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.4.14'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data/etcd/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("data,wal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /data/etcd/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://github.com/coreos/etcd/releases/download/v"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ETCD_VERSION}")]),t._v("/etcd-v"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ETCD_VERSION}")]),t._v("-linux-amd64.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 解压")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xvf etcd-v"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ETCD_VERSION}")]),t._v("-linux-amd64.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 复制到/usr/local/bin/下，默认已经有可执行权限了，无需在使用chmod +x。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" etcd-v"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${VER}")]),t._v("-linux-amd64/etcd* /usr/local/bin/\n")])])]),a("h3",{attrs:{id:"使用systemd管理服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用systemd管理服务"}},[t._v("#")]),t._v(" 使用Systemd管理服务")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置变量")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NODE_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'etcd-single'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NODE_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'172.25.1.93'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ETCD_DATA_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/data/etcd/data'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ETCD_WAL_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/data/etcd/wal'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建Systemd Unit管理文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  /etc/systemd/system/etcd.service "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("EOF\n[Unit]\nDescription=Etcd Server\nAfter=network.target\nAfter=network-online.target\nWants=network-online.target\nDocumentation=https://github.com/coreos\n\n[Service]\nType=notify\nWorkingDirectory="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ETCD_DATA_DIR}")]),t._v("\nExecStart=/usr/local/bin/etcd "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --data-dir="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ETCD_DATA_DIR}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --wal-dir="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ETCD_WAL_DIR}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --name="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${NODE_NAME}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --listen-peer-urls=http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${NODE_IP}")]),t._v(":2380 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --initial-advertise-peer-urls=http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${NODE_IP}")]),t._v(":2380 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --listen-client-urls=http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${NODE_IP}")]),t._v(":2379,http://127.0.0.1:2379 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --advertise-client-urls=http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${NODE_IP}")]),t._v(":2379 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --auto-compaction-mode=periodic "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --auto-compaction-retention=1 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --max-request-bytes=33554432 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --quota-backend-bytes=6442450944 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --heartbeat-interval=250 "),a("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[t._v("\\\\")]),t._v("\n  --election-timeout=2000\nRestart=on-failure\nRestartSec=5\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),t._v("\n")])])]),a("h3",{attrs:{id:"启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[t._v("#")]),t._v(" 启动服务")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" etcd\nsystemctl start etcd\nsystemctl status etcd\n")])])]),a("h3",{attrs:{id:"验证etcd服务状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证etcd服务状态"}},[t._v("#")]),t._v(" 验证ETCD服务状态")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证IP")]),t._v("\netcdctl --endpoints"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${NODE_IP}")]),t._v(":2379 endpoint health\n输出结果：\nhttp://172.25.1.93:2379 is healthy: successfully committed proposal: took "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".632444ms\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证本地")]),t._v("\netcdctl --endpoints"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://127.0.0.1:2379 endpoint health\n输出结果：\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:2379 is healthy: successfully committed proposal: took "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".716469ms\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);